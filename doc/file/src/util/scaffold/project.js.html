<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <base data-ice="baseUrl" href="../../../../">
  <title data-ice="title">src/util/scaffold/project.js | API Document</title>
  <link type="text/css" rel="stylesheet" href="css/style.css">
  <link type="text/css" rel="stylesheet" href="css/prettify-tomorrow.css">
  <script src="script/prettify/prettify.js"></script>
  
  
</head>
<body class="layout-container">

<header>
  <a href="./">Home</a>
  <a href="identifiers.html">Identifier</a>
  <a href="source.html">Source</a>
  
  <a data-ice="repoURL" href="https://github.com/benderTheCrime/angie.git" class="repo-url-github">Repository</a>
  <div class="search-box">
  <span>
    <img src="./image/search.png">
    <span class="search-input-edge"></span><input class="search-input"><span class="search-input-edge"></span>
  </span>
    <ul class="search-result"></ul>
  </div>
</header>

<nav class="navigation" data-ice="nav"><div data-ice="classWrap">
  <h2>Class</h2>
  <ul>
    
  <li data-ice="classDoc"><span><a href="class/src/util/$ExceptionsProvider.js~$$InvalidConfigError.html">$$InvalidConfigError</a></span></li>
<li data-ice="classDoc"><span><a href="class/src/factories/$CacheFactory.js~$CacheFactory.html">$CacheFactory</a></span></li>
<li data-ice="classDoc"><span><a href="class/src/util/$MimeTypeProvider.js~$MimeTypeProvider.html">$MimeTypeProvider</a></span></li>
<li data-ice="classDoc"><span><a href="class/src/services/$Request.js~$Request.html">$Request</a></span></li>
<li data-ice="classDoc"><span><a href="class/src/services/$Responses.js~$Response.html">$Response</a></span></li>
<li data-ice="classDoc"><span><a href="class/src/factories/$RouteProvider.js~$RouteProvider.html">$RouteProvider</a></span></li>
<li data-ice="classDoc"><span><a href="class/src/factories/$TemplateCache.js~$TemplateCache.html">$TemplateCache</a></span></li>
<li data-ice="classDoc"><span><a href="class/src/factories/$Compile.js~$window.html">$window</a></span></li>
<li data-ice="classDoc"><span><a href="class/src/Angie.js~Angie.html">Angie</a></span></li>
<li data-ice="classDoc"><span><a href="class/src/services/BaseRequest.js~BaseRequest.html">BaseRequest</a></span></li>
<li data-ice="classDoc"><span><a href="class/src/Config.js~Config.html">Config</a></span></li>
</ul>
</div>



<div data-ice="functionWrap">
  <h2><a href="function/">Function</a></h2>
  <ul>
    
  <li data-ice="functionDoc"><span><a href="function/index.html#static-function-Base">Base</a></span></li>
<li data-ice="functionDoc"><span><a href="function/index.html#static-function-shell">shell</a></span></li>
<li data-ice="functionDoc"><span><a href="function/index.html#static-function-watch">watch</a></span></li>
</ul>
</div>






</nav>

<div class="content" data-ice="content"><h1 data-ice="title">src/util/scaffold/project.js</h1>
<pre class="source-code line-number"><code class="prettyprint linenums" data-ice="content">/**
 * @module project.js
 * @author Joe Groseclose &lt;@benderTheCrime&gt;
 * @date 8/16/2015
 */

// System Modules
// Do not alias this as the commands mirror the global `confirm` and `prompt`
import {default as promptly} from       &apos;promptly&apos;;
import fs from                          &apos;fs&apos;;
import util from                        &apos;util&apos;;
import chalk, {
    bold,
    green
} from                                  &apos;chalk&apos;;
import $LogProvider from                &apos;angie-log&apos;;

// Angie Modules
import {$StringUtil} from                &apos;../Util&apos;;

const p = process,
      breen = (v) =&gt; bold(green(v));

/**
 * @desc $$createProject is the function called when the CLI attempts to create
 * a project from the command line. This scaffolds the main folder in the
 * specified location or no folder and then folders for commonly used providers
 * and the Angie config file (AngieFile.json).
 *
 * The CLI function to create a project will ask the user a series of questions.
 * The result of these questions will be passed to the AngieFile.json.
 *
 * This function will gracefully exit the process if successful and exit with
 * errors if unsuccessful.
 * @since 0.0.1
 * @todo If any more CL arguments are required, you must abstract confirm/prompt
 * as functions
 * @param {object} args A list of arugments passed from the CLI parser
 * @param {string} args.name The name of the project being created. This must
 * consist of letters, dashes, &amp; underscores
 * @param {string} args.location [param=process.cwd()] The location in which the
 * inner files of the project are created. CWD if no location is specified.
 * @access private
 */
export default function $$createProject(args = {}) {

    // Parse the passed arguments object
    const name = args.name,
          location = $StringUtil.removeTrailingLeadingSlashes(args.location);
    let mkDir,
        mkDirFiles,
        mkSub;

    // The process must exit if there is no passed name, or the name passed is
    // in an incorrect format
    if (!name) {
        throw new $$ProjectCreationError(&apos;No project name specified&apos;);
    } else if (
        /[0-9$%\^&amp;*\)\(\&lt;\&gt;\\\/\.\,\`\?\+\!\~#@=\}\{\|\]\[\&apos;\&quot;\:\;]+/i.test(name)
    ) {

        // Being super specific about which characters are OK and which are not
        throw new $$ProjectCreationError(
            &apos;Invalid project name: must be all letters, dashes, &amp; underscores&apos;
        );
    }

    // Make sure that we&apos;re creating the project in the right spot
    mkDir = location ? (location === &apos;.&apos; ? &apos;&apos; : location) : `${p.cwd()}/${name}`;
    mkDirFiles = mkDir ? `${mkDir}/` : &apos;&apos;;
    mkSub = `${mkDirFiles}src`.replace(/\/{2}/g, &apos;/&apos;);

    try {

        // We cannot create a dir if the argument is empty
        if (mkDir) {
            fs.mkdirSync(mkDir);
        }
        fs.mkdirSync(mkSub);

        // Create provider folders
        [
            &apos;constants&apos;,
            &apos;configs&apos;,
            &apos;services&apos;,
            &apos;controllers&apos;,
            &apos;directives&apos;
        ].forEach(function(v) {
            fs.mkdirSync(`${mkSub}/${v}`);
        });

        // Create static folders
        [
            &apos;test&apos;,
            &apos;static&apos;,
            &apos;templates&apos;
        ].forEach(function(v) {
            fs.mkdirSync(`${mkDirFiles}${v}`);
        });
    } catch(e) {
        throw new $$ProjectCreationError(e);
    } finally {

        // This is where we create our AngieFile, we can pick certain values with
        // which we can populate our config:

        // cacheStaticAssets
        let staticCache = false,

            // Default JS to be loaded with all HTML files
            defaultAppJavaScriptFilename;

        // Wrap the prompts in a Promise
        new Promise(function(resolve) {
            promptly.confirm(
                `${breen(&apos;Do you want Angie to cache static assets?&apos;)} :`,
                resolve
            );
        }).then(function(v) {
            staticCache = !!v;
            return;
        }).then(function() {

            // Ask what the default JS filename should be
            return new Promise(function(resolve) {
                return promptly.prompt(
                    `${breen(
                        &apos;What would you like to call the &quot;default&quot; &apos; +
                        &apos;loaded script file &apos; +
                        `(${bold(chalk.white(&apos;default is&apos;))} ` +
                        `${chalk.cyan(&apos;application.js&apos;)})?`
                     )} :`,
                     {
                         default: &apos;application.js&apos;,
                         validator: function(v) {
                             if (v &amp;&amp; v.indexOf(&apos;.js&apos;) === -1) {
                                 throw new Error(
                                     bold(chalk.red(
                                         &apos;Input must be a valid &quot;.js&quot; file.&apos;
                                     ))
                                 );
                             }
                             return v.replace(/\/|\\/g, &apos;&apos;);
                         }
                     },
                    function(e, v) {
                        resolve(v);
                    }
                );
            });
        }).then(function(v) {
            defaultAppJavaScriptFilename = v;
        }).then(function() {

            // Read our AngieFile template and reproduce in the target directory
            let template = fs.readFileSync(
                `${__dirname}/../../templates/json/AngieFile.template.json`,
                &apos;utf8&apos;
            );
            template = util.format(
                template,
                name,
                name,
                staticCache,
                defaultAppJavaScriptFilename
            );
            fs.writeFileSync(
                `${mkDirFiles}AngieFile.json`,
                template,
                &apos;utf8&apos;
            );
            fs.writeFileSync(
                `${mkDirFiles}static/${defaultAppJavaScriptFilename}`,
                &apos;&apos;
            );

            $LogProvider.info(&apos;Project successfully created&apos;);
            p.exit(0);
        }).catch(function(e) {
            console.log(e);
        });
    }
}

class $$ProjectCreationError extends Error {
    constructor(e) {
        $LogProvider.error(e);
        super(e);
    }
}</code></pre>
</div>

<footer class="footer">
  Generated by <a href="https://esdoc.org">ESDoc<span data-ice="esdocVersion">(0.1.2)</span></a>
</footer>

<script src="script/search_index.js"></script>
<script src="script/search.js"></script>
<script src="script/pretty-print.js"></script>
<script src="script/inherited-summary.js"></script>
<script src="script/test-summary.js"></script>
<script src="script/inner-link.js"></script>
<script src="script/patch-for-local.js"></script>
</body>
</html>
