<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <base data-ice="baseUrl" href="../../../">
  <title data-ice="title">src/factories/$RouteProvider.js | API Document</title>
  <link type="text/css" rel="stylesheet" href="css/style.css">
  <link type="text/css" rel="stylesheet" href="css/prettify-tomorrow.css">
  <script src="script/prettify/prettify.js"></script>
  
  
</head>
<body class="layout-container">

<header>
  <a href="./">Home</a>
  <a href="identifiers.html">Identifier</a>
  <a href="source.html">Source</a>
  
  <a data-ice="repoURL" href="https://github.com/benderTheCrime/angie.git" class="repo-url-github">Repository</a>
  <div class="search-box">
  <span>
    <img src="./image/search.png">
    <span class="search-input-edge"></span><input class="search-input"><span class="search-input-edge"></span>
  </span>
    <ul class="search-result"></ul>
  </div>
</header>

<nav class="navigation" data-ice="nav"><div data-ice="classWrap">
  <h2>Class</h2>
  <ul>
    
  <li data-ice="classDoc"><span><a href="class/src/util/$ExceptionsProvider.js~$$InvalidConfigError.html">$$InvalidConfigError</a></span></li>
<li data-ice="classDoc"><span><a href="class/src/factories/$CacheFactory.js~$CacheFactory.html">$CacheFactory</a></span></li>
<li data-ice="classDoc"><span><a href="class/src/util/$MimeTypeProvider.js~$MimeTypeProvider.html">$MimeTypeProvider</a></span></li>
<li data-ice="classDoc"><span><a href="class/src/services/$Request.js~$Request.html">$Request</a></span></li>
<li data-ice="classDoc"><span><a href="class/src/services/$Responses.js~$Response.html">$Response</a></span></li>
<li data-ice="classDoc"><span><a href="class/src/factories/$RouteProvider.js~$RouteProvider.html">$RouteProvider</a></span></li>
<li data-ice="classDoc"><span><a href="class/src/factories/$TemplateCache.js~$TemplateCache.html">$TemplateCache</a></span></li>
<li data-ice="classDoc"><span><a href="class/src/factories/$Compile.js~$window.html">$window</a></span></li>
<li data-ice="classDoc"><span><a href="class/src/Angie.js~Angie.html">Angie</a></span></li>
<li data-ice="classDoc"><span><a href="class/src/services/BaseRequest.js~BaseRequest.html">BaseRequest</a></span></li>
<li data-ice="classDoc"><span><a href="class/src/Config.js~Config.html">Config</a></span></li>
</ul>
</div>



<div data-ice="functionWrap">
  <h2><a href="function/">Function</a></h2>
  <ul>
    
  <li data-ice="functionDoc"><span><a href="function/index.html#static-function-Base">Base</a></span></li>
<li data-ice="functionDoc"><span><a href="function/index.html#static-function-server">server</a></span></li>
<li data-ice="functionDoc"><span><a href="function/index.html#static-function-shell">shell</a></span></li>
</ul>
</div>






</nav>

<div class="content" data-ice="content"><h1 data-ice="title">src/factories/$RouteProvider.js</h1>
<pre class="source-code line-number"><code class="prettyprint linenums" data-ice="content">/**
 * @module $RouteProvider.js
 * @author Joe Groseclose &lt;@benderTheCrime&gt;
 * @date 8/16/2015
 */

// System Modules
import $LogProvider from    &apos;angie-log&apos;;

// Angie Modules
import {$StringUtil} from   &apos;../util/Util&apos;;

const IGNORE_KEYS = [
    &apos;Controller&apos;,
    &apos;template&apos;,
    &apos;templatePath&apos;
];
let routes = {
        &apos;/&apos;: {
            templatePath: &apos;index.html&apos;
        },
        &apos;/404&apos;: {
            templatePath: &apos;404.html&apos;
        },
        &apos;/500&apos;: {
            templatePath: &apos;404.html&apos;
        }
    },
    otherwise;

/**
 * @desc $RouteProvider is provided to any service, Controller, directive, Model,
 * or view which has included it as an argument as &quot;&quot;$Routes&quot;
 *
 * It can also be referenced as `app.services.$Routes` or imported as
 * &apos;$RouteProvider&apos; from the Angie Path.
 * @since 0.0.1
 */
class $RouteProvider {

    /**
     * @desc Sets up a route as a possible endpoint in an Angie application..
     * @since 0.0.1
     * @param {string|Object} str String or RegExp to denote the endpoint
     * path
     * @param {Object} obj
     * @param {?string} obj.templatePath Optional template path
     * @param {?string} obj.template Optional template html
     * @param {?string} obj.Controller The name of the associated Controller
     * @param {?object} obj.* A deep route with another route object
     * to associate with a route consisting of the original path added to the
     * new key
     * @returns {function} Template function, compiles in whatever scope is
     * passed
     * @access public
     * @example $Routes.when(&apos;/test&apos;, {
     *     template: &apos;&lt;div&gt;{{{test}}}&lt;/div&gt;&apos;,
     *     Controller: &apos;TestCtrl&apos;,
     *     test2: {
     *         template: &apos;&lt;div&gt;{{{test2}}}&lt;/div&gt;&apos;,
               Controller: &apos;Test2Ctrl&apos;
     *     }
     * });
     */
    static when(path, obj) {
        let regExpFlag = false;

        // Determine if the route is RegExp or not and register the route
        if (path.constructor.name === &apos;RegExp&apos;) {
            regExpFlag = true;

            // Set the route regExp identifier
            if (!routes.regExp) {
                routes.regExp = {};
            }

            // Set a RegExp route
            routes.regExp[ path ] = obj;
        } else {

            // Set a string route
            routes[ path ] = obj;
        }

        // Find any &quot;deep&quot; routes which we may want to add on to the root route
        Object.keys(obj).forEach(function(v) {
            let childPath,
                childObj = obj[ v ];

            // We&apos;re talking about a template or a Controller and we don&apos;t want
            // that
            // It&apos;s worth noting that return based &quot;if&quot;s in Coffee are pretty
            // dope
            if (IGNORE_KEYS.indexOf(v) &gt; -1) {
                return;
            } else if (regExpFlag || /\/.*\//.test(v)) {

                // Check to see if we previously had or now have a path with
                // RegExp
                childPath = $RouteProvider.$stringsToRegExp(
                    path,
                    $StringUtil.removeTrailingLeadingSlashes(v)
                );
            } else {

                // Concatenate two string paths
                childPath = [ path, v ].join(&apos;/&apos;).replace(/\/\//g, &apos;/&apos;);
            }

            // If the child route does not have a Controller, force it to
            // it&apos;s parent inherit
            if (obj.Controller &amp;&amp; !childObj.Controller) {
                childObj.Controller = obj.Controller;
            }

            // Set a route child object
            $RouteProvider.when(childPath, childObj);

            // Strip the child from the original route object
            delete obj[ v ];
        });
        return this;
    }

    /**
     * @desc Sets a defaulted path in the event that none of the other routes
     * or route patterns are matching. If this is a relative path, it will match
     * absolutely. If this is a full path, it will result in a 301 redirect.
     *
     * @since 0.0.1
     * @param {string} path URL string to set as the &quot;otherwise&quot; path
     * @returns {string} The same URL string
     * @access public
     * @example $Route.otherwise(&apos;/test&apos;);
     */
    static otherwise(path) {
        if (typeof path === &apos;string&apos;) {
            otherwise = path;
        } else {

            // Redirection can only occur based on this path if path is a string
            $LogProvider.warn(
                &apos;Cannot set &quot;otherwise&quot; route to anything other than a string&apos;
            );
        }
        return path;
    }

    /**
     * @desc Returns all of the set application routes
     * @since 0.0.1
     * @returns {object} Routes object (inc. RegExps) and otherwise path objects
     * @access public
     */
    static fetch() {
        let obj = { routes: routes };
        if (otherwise) {
            obj.otherwise = otherwise;
        }
        return obj;
    }

    /**
     * @desc $Routes.$$clear is a helper method designated to clear out all
     * of the routes in the test environment. Don&apos;t call it or you might have a
     * bad time.
     * @since 0.2.5
     * @access private
     * @example $Routes.$$clear() // routes = {};
     */
    static $$clear() {
        routes = {};
        otherwise = undefined;
    }

    /**
     * @desc Take RegExp literals or strings and return a new RexExp
     * @since 0.2.5
     * @param {string|object} str Arguments of strings or RegExp literals
     * @returns {object} Concatenated RegExps joined by &quot;/&quot;
     * @access private
     * @example var regExp = $Routes.$stringsToRegExp(/test/, test);
     *     regExp.test(&apos;test/test&apos;) === true;
     */
    static $stringsToRegExp() {
        return new RegExp(Array.prototype.slice.call(arguments).map((v) =&gt;
            $StringUtil.removeTrailingLeadingSlashes(v.toString())
        ).join(&apos;\\/&apos;));
    }

    /**
     * @desc $Routes.$$parseURLParams is a function that will strip the
     * paramters out of RegExp pattern routes
     *
     * It is a private method
     * @since 0.2.3
     * @param {string} t Template string to be processed
     * @returns {function} Template function, compiles in whatever scope is passed
     * @access private
     * @example $compile(&apos;{{{test}}}&apos;)({ test: 1 }) === 1; // true
     */
    static $$parseURLParams(pattern, path) {
        let obj = {};

        // If and only if the pattern and path exist
        if (pattern &amp;&amp; path) {

            // Strip slashes
            $StringUtil.removeTrailingLeadingSlashes(
                path.replace(pattern, &apos;$1|$2|$3|$4|$5&apos;)
            ).split(&apos;|&apos;).forEach(

                // Pull the paramter from the parsed replace string if there is
                // a match
                function(v, i) {
                    if (v.indexOf(`$${i + 1}`) === -1) {
                        obj[ i ] = v;
                    }
                }
            );
        }

        // Param keys are matched indices and flagged with keys 0-5
        return obj;
    }
}

export default $RouteProvider;
</code></pre>
</div>

<footer class="footer">
  Generated by <a href="https://esdoc.org">ESDoc<span data-ice="esdocVersion">(0.1.2)</span></a>
</footer>

<script src="script/search_index.js"></script>
<script src="script/search.js"></script>
<script src="script/pretty-print.js"></script>
<script src="script/inherited-summary.js"></script>
<script src="script/test-summary.js"></script>
<script src="script/inner-link.js"></script>
<script src="script/patch-for-local.js"></script>
</body>
</html>
