<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <base data-ice="baseUrl" href="../../">
  <title data-ice="title">src/Angular.js | API Document</title>
  <link type="text/css" rel="stylesheet" href="css/style.css">
  <link type="text/css" rel="stylesheet" href="css/prettify-tomorrow.css">
  <script src="script/prettify/prettify.js"></script>
  
  
</head>
<body class="layout-container">

<header>
  <a href="./">Home</a>
  <a href="identifiers.html">Identifier</a>
  <a href="source.html">Source</a>
  
  <a data-ice="repoURL" href="https://github.com/benderTheCrime/angie.git" class="repo-url-github">Repository</a>
  <div class="search-box">
  <span>
    <img src="./image/search.png">
    <span class="search-input-edge"></span><input class="search-input"><span class="search-input-edge"></span>
  </span>
    <ul class="search-result"></ul>
  </div>
</header>

<nav class="navigation" data-ice="nav"><div data-ice="classWrap">
  <h2>Class</h2>
  <ul>
    
  <li data-ice="classDoc"><span><a href="class/src/services/$CacheFactory.js~$CacheFactory.html">$CacheFactory</a></span></li>
<li data-ice="classDoc"><span><a href="class/src/util/$ExceptionsProvider.js~$Exceptions.html">$Exceptions</a></span></li>
<li data-ice="classDoc"><span><a href="class/src/services/$injector.js~$Injector.html">$Injector</a></span></li>
<li data-ice="classDoc"><span><a href="class/src/util/$LogProvider.js~$LogProvider.html">$LogProvider</a></span></li>
<li data-ice="classDoc"><span><a href="class/src/services/$Request.js~$Request.html">$Request</a></span></li>
<li data-ice="classDoc"><span><a href="class/src/services/$Responses.js~$Response.html">$Response</a></span></li>
<li data-ice="classDoc"><span><a href="class/src/services/$RouteProvider.js~$RouteProvider.html">$RouteProvider</a></span></li>
<li data-ice="classDoc"><span><a href="class/src/controllers/$ScopeProvider.js~$ScopeProvider.html">$ScopeProvider</a></span></li>
<li data-ice="classDoc"><span><a href="class/src/services/$TemplateCache.js~$TemplateCache.html">$TemplateCache</a></span></li>
<li data-ice="classDoc"><span><a href="class/src/Angular.js~Angular.html">Angular</a></span></li>
<li data-ice="classDoc"><span><a href="class/src/models/BaseDBConnection.js~BaseDBConnection.html">BaseDBConnection</a></span></li>
<li data-ice="classDoc"><span><a href="class/src/models/Fields.js~BaseField.html">BaseField</a></span></li>
<li data-ice="classDoc"><span><a href="class/src/models/BaseModel.js~BaseModel.html">BaseModel</a></span></li>
<li data-ice="classDoc"><span><a href="class/src/services/BaseRequest.js~BaseRequest.html">BaseRequest</a></span></li>
<li data-ice="classDoc"><span><a href="class/src/Config.js~Config.html">Config</a></span></li>
<li data-ice="classDoc"><span><a href="class/src/models/MySqlConnection.js~MySqlConnection.html">MySqlConnection</a></span></li>
<li data-ice="classDoc"><span><a href="class/src/models/SqliteConnection.js~SqliteConnection.html">SqliteConnection</a></span></li>
</ul>
</div>



<div data-ice="functionWrap">
  <h2><a href="function/">Function</a></h2>
  <ul>
    
  <li data-ice="functionDoc"><span><a href="function/index.html#static-function-AngieDatabaseRouter">AngieDatabaseRouter</a></span></li>
<li data-ice="functionDoc"><span><a href="function/index.html#static-function-checkConfig">checkConfig</a></span></li>
<li data-ice="functionDoc"><span><a href="function/index.html#static-function-compile">compile</a></span></li>
<li data-ice="functionDoc"><span><a href="function/index.html#static-function-createProject">createProject</a></span></li>
<li data-ice="functionDoc"><span><a href="function/index.html#static-function-restart">restart</a></span></li>
<li data-ice="functionDoc"><span><a href="function/index.html#static-function-shell">shell</a></span></li>
</ul>
</div>






</nav>

<div class="content" data-ice="content"><h1 data-ice="title">src/Angular.js</h1>
<pre class="source-code line-number"><code class="prettyprint linenums" data-ice="content">&apos;use strict&apos;; &apos;use strong&apos;;

import util from &apos;./util/util&apos;;
import $log from &apos;./util/$LogProvider&apos;;
import $Exceptions from &apos;./util/$ExceptionsProvider&apos;;
import {BaseModel} from &apos;./models/BaseModel&apos;;
import {$injectionBinder} from &apos;./services/$Injector&apos;;

const fs =          require(&apos;fs&apos;);

const p = process;

/**
 * This is the default Angie Angular class. It is instantiated and given
 * the namespace `global.app`. Static methods are available via this
 * instance.
 * @example
 */
class Angular {

    /**
     * Constructor
     */
    constructor() {
        this.constants = {};
        this.configs = [];
        this.services = {};
        this.Controllers = {};
        this.Models = {};
        this.directives = {};
        this._registry = {};
        this._dependencies = [];
    }

    /**
     * Creates an Angie Angular constant provider
     * @param {string} name The name of the constant being created
     * @param {object|string|number|Array&lt;&gt;|boolean} obj The object value
     * @returns {object} this instanceof Angular
     */
    constant(name, obj = {}) {
        return this._register(&apos;constants&apos;, name, obj);
    }
    service(name, obj = {}) {
        return this._register(&apos;services&apos;, name, obj);
    }
    Controller(name, obj = {}) {
        return this._register(&apos;Controllers&apos;, name, obj);
    }
    directive(name, obj = {}) {

        // TODO dependencies
        let dir = new $injectionBinder(obj)();
        return this._register(&apos;directives&apos;, name, dir);
    }
    config(fn) {
        this.configs.push({
            fn: fn,
            fired: false
        });
        return this;
    }
    Model(name, obj = {}) {
        obj = obj.prototype ? new obj() : typeof obj === &apos;function&apos; ? obj() : obj;
        name = typeof name === &apos;string&apos; ? name : obj.name;

        let instance = new BaseModel(name);

        // Mock extend obj onto the instance
        if (typeof obj === &apos;object&apos;) {
            instance = this.extend(instance, obj);
        } else {
            $Exceptions.$$invalidModelConfig(name);
        }

        return this._register(&apos;Models&apos;, name, instance);
    }
    _register(component, name, obj) {
        if (this[component]) {
            this._registry[name] = component;
            this[component][name] = obj;
        }
        return this;
    }
    loadDependencies(dependencies = []) {
        let me = this,
            proms = [];

        // Add dependencies
        this._dependencies = this._dependencies.concat(dependencies);

        if (dependencies) {
            dependencies.forEach(function(v) {

                if (v.charAt(v.length - 1) === &apos;/&apos;) {
                    v = v.slice(v.length - 1, 1);
                }

                // This should be the root folder of an Angie project
                let config = fs.readFileSync(`${v}/AngieFile.json`) || &apos;{, }&apos;;

                try {
                    config = JSON.parse(config);
                } catch(e) {
                    $log.error(`Could not load ${v}, error parsing AngieFile`);
                    return;
                }

                // This will load all of the modules, overwriting a module name
                // will replace it
                let prom = new Promise(function(resolve) {
                    me.bootstrap(v).then(function() {
                        resolve();
                    }).then(function() {
                        me.loadDependencies(config.dependencies);
                    });
                });
                proms.push(prom);
            });
        }

        // TODO issue with this taking too long
        return Promise.all(proms);
    }
    bootstrap(dir = p.cwd()) {
        let me = this,
            files;

        // Load all of the files from the project
        // TODO also look for &quot;.config.&quot; files
        [
            &apos;constants&apos;,
            &apos;configs&apos;,
            &apos;services&apos;,
            &apos;controllers&apos;,
            &apos;models&apos;,
            &apos;directives&apos;
        ].forEach(function(v) {
            try {
                files = fs.readdirSync(`${dir}/${v}`);
                files.forEach(function(w) {

                    // TODO do this with System
                    require(`${dir}/src/${v}/${w}`);
                });
            } catch(e) {} // Moot error, I don&apos;t really care if you muss with things
            try {
                files = fs.readdirSync(`${dir}/src/${v}`);
                files.forEach(function(w) {

                    // TODO do this with System
                    require(`${dir}/src/${v}/${w}`);
                });
            } catch(e) {} // Moot error, I don&apos;t really care if you muss with things
        });

        // Import the app
        return new Promise(function(resolve) {

            // Once all of the modules are loaded, run the configs
            me.configs.forEach(function(v) {

                // Check to see if the config has already fired, if it has, we
                // do not want to fire it again
                if (!v.fired) {
                    new me.services.$injectionBinder(v.fn)();
                }
            });

            resolve();
        });
    }
    __dropBootStrapMethods__() {
        delete this._register;
        delete this.constant;
        delete this.service;
        delete this.Controller;
        delete this.directive;
        delete this.config;
        delete this.Model;
        return this;
    }
    static noop() {}
}

Angular = util.extend(Angular, util);
const angular = global.angular = class angular extends Angular{};
export default angular;
</code></pre>
</div>

<footer class="footer">
  Generated by <a href="https://esdoc.org">ESDoc<span data-ice="esdocVersion">(0.1.2)</span></a>
</footer>

<script src="script/search_index.js"></script>
<script src="script/search.js"></script>
<script src="script/pretty-print.js"></script>
<script src="script/inherited-summary.js"></script>
<script src="script/test-summary.js"></script>
<script src="script/inner-link.js"></script>
<script src="script/patch-for-local.js"></script>
</body>
</html>
